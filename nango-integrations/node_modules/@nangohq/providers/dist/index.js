import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import yaml from 'js-yaml';
import { clearLocalizationCache, getLocalizedProviders } from './localization.js';
const __filename = fileURLToPath(import.meta.url);
const pkgRoot = path.join(__filename, '../../');
let providers = undefined;
export function updateProviderCache(update) {
    providers = update;
    // Clear language cache when base providers are updated
    clearLocalizationCache();
}
export function getProviders(language) {
    if (!providers) {
        providers = loadProvidersYaml();
    }
    if (!providers || !language) {
        return providers;
    }
    return getLocalizedProviders(providers, language);
}
export function getProvider(providerName, language) {
    const providers = getProviders(language);
    return providers?.[providerName] ?? null;
}
export function loadProvidersYaml() {
    try {
        const providersYamlPath = path.join(pkgRoot, 'providers.yaml');
        const fileEntries = yaml.load(fs.readFileSync(providersYamlPath).toString());
        if (fileEntries == null) {
            throw new Error('provider_template_loading_failed');
        }
        for (const key in fileEntries) {
            const entry = fileEntries[key];
            if (entry && 'alias' in entry) {
                if (Object.keys(entry).length <= 0) {
                    console.error('Failed to find alias', entry.alias);
                    continue;
                }
                const { alias, ...overrides } = entry;
                const aliasData = fileEntries[entry.alias];
                fileEntries[key] = { ...aliasData, ...overrides };
            }
        }
        return fileEntries;
    }
    catch (err) {
        console.error('Failed to load providers.yaml', err);
    }
    return;
}
//# sourceMappingURL=index.js.map